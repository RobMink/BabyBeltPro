[delayed_gcode sfs_motion_intro]
initial_duration: 1
gcode:
    {action_respond_info("BTT SFS V2 Motion Detection Enabled!")}
 
[filament_motion_sensor encoder_sensor]
switch_pin: ^Z_PROBE_END
detection_length: 7 # accuracy of motion sensor 2.88mm
extruder: extruder
pause_on_runout: True
runout_gcode:
 M600
 M117 Filament encoder runout
insert_gcode:
 M117 Filament encoder inserted

[gcode_macro MOTION_SENSOR]
description: Detect filament moving
gcode:
  {% set en = params.ENABLE|default(1)|int %}
  {% if 'filament_motion_sensor encoder_sensor' in printer %}
    SET_FILAMENT_SENSOR SENSOR=encoder_sensor ENABLE={en}
  {% else %}
    {action_respond_info("encoder_sensor does not exist")}
  {% endif %}

[delayed_gcode ENABLE_MOTION_SENSOR]
gcode:
  {% if 'filament_motion_sensor motion_sensor' in printer %}
    SET_FILAMENT_SENSOR SENSOR=motion_sensor ENABLE=1
  {% else %}
    {action_respond_info("motion_sensor does not exist")}
  {% endif %}